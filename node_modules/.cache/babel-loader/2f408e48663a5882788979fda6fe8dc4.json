{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar types_1 = require(\"./types\");\n\nvar resolutionError_1 = __importStar(require(\"./errors/resolutionError\"));\n\nvar utils_1 = require(\"./utils\");\n\nvar publicTypes_1 = require(\"./types/publicTypes\");\n\nvar TwitterSignatureValidator_1 = require(\"./utils/TwitterSignatureValidator\");\n\nvar FetchProvider_1 = __importDefault(require(\"./FetchProvider\"));\n\nvar namehash_1 = require(\"./utils/namehash\");\n\nvar NamingService_1 = require(\"./NamingService\");\n\nvar configurationError_1 = __importStar(require(\"./errors/configurationError\"));\n\nvar UnsInternal_1 = __importDefault(require(\"./UnsInternal\"));\n\nvar Networking_1 = __importDefault(require(\"./utils/Networking\"));\n\nvar resolver_keys_json_1 = __importDefault(require(\"./config/resolver-keys.json\"));\n/**\n * @internal\n */\n\n\nvar Uns =\n/** @class */\nfunction (_super) {\n  __extends(Uns, _super);\n\n  function Uns(source) {\n    var _this = _super.call(this) || this;\n\n    _this.name = publicTypes_1.NamingServiceName.UNS;\n\n    if (source && source.locations && (!source.locations.Layer1 || !source.locations.Layer2)) {\n      throw new configurationError_1.default(configurationError_1.ConfigurationErrorCode.NetworkConfigMissing, {\n        method: publicTypes_1.NamingServiceName.UNS,\n        config: !source.locations.Layer1 ? 'Layer1' : 'Layer2'\n      });\n    }\n\n    if (!source) {\n      source = {\n        locations: {\n          Layer1: {\n            url: UnsInternal_1.default.UrlMap['mainnet'],\n            network: 'mainnet'\n          },\n          Layer2: {\n            url: UnsInternal_1.default.UrlMap['polygon-mainnet'],\n            network: 'polygon-mainnet'\n          }\n        }\n      };\n    }\n\n    _this.unsl1 = new UnsInternal_1.default(publicTypes_1.UnsLocation.Layer1, source.locations.Layer1, publicTypes_1.BlockchainType.ETH);\n    _this.unsl2 = new UnsInternal_1.default(publicTypes_1.UnsLocation.Layer2, source.locations.Layer2, publicTypes_1.BlockchainType.MATIC);\n    return _this;\n  }\n\n  Uns.autoNetwork = function (config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var providerLayer1, providerLayer2, networkIdLayer1, networkIdLayer2, networkNameLayer1, networkNameLayer2;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (types_1.hasProvider(config.locations.Layer1) && types_1.hasProvider(config.locations.Layer2)) {\n              providerLayer1 = config.locations.Layer1.provider;\n              providerLayer2 = config.locations.Layer2.provider;\n            } else {\n              if (!config.locations.Layer1['url'] || !config.locations.Layer2['url']) {\n                throw new configurationError_1.default(configurationError_1.ConfigurationErrorCode.UnspecifiedUrl, {\n                  method: publicTypes_1.NamingServiceName.UNS\n                });\n              }\n\n              providerLayer1 = FetchProvider_1.default.factory(publicTypes_1.NamingServiceName.UNS, config.locations.Layer1['url']);\n              providerLayer2 = FetchProvider_1.default.factory(publicTypes_1.NamingServiceName.UNS, config.locations.Layer2['url']);\n            }\n\n            return [4\n            /*yield*/\n            , providerLayer1.request({\n              method: 'net_version'\n            })];\n\n          case 1:\n            networkIdLayer1 = _a.sent();\n            return [4\n            /*yield*/\n            , providerLayer2.request({\n              method: 'net_version'\n            })];\n\n          case 2:\n            networkIdLayer2 = _a.sent();\n            networkNameLayer1 = utils_1.EthereumNetworksInverted[networkIdLayer1];\n            networkNameLayer2 = utils_1.EthereumNetworksInverted[networkIdLayer2];\n\n            if (!networkNameLayer1 || !types_1.UnsSupportedNetwork.guard(networkNameLayer1) || !networkNameLayer2 || !types_1.UnsSupportedNetwork.guard(networkNameLayer2)) {\n              throw new configurationError_1.default(configurationError_1.ConfigurationErrorCode.UnsupportedNetwork, {\n                method: publicTypes_1.NamingServiceName.UNS\n              });\n            }\n\n            return [2\n            /*return*/\n            , new this({\n              locations: {\n                Layer1: {\n                  network: networkNameLayer1,\n                  provider: providerLayer1\n                },\n                Layer2: {\n                  network: networkNameLayer2,\n                  provider: providerLayer2\n                }\n              }\n            })];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.namehash = function (domain) {\n    if (!this.checkDomain(domain)) {\n      throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnsupportedDomain, {\n        domain: domain\n      });\n    }\n\n    return namehash_1.eip137Namehash(domain);\n  };\n\n  Uns.prototype.childhash = function (parentHash, label) {\n    return namehash_1.eip137Childhash(parentHash, label);\n  };\n\n  Uns.prototype.serviceName = function () {\n    return this.name;\n  };\n\n  Uns.prototype.isSupportedDomain = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tld, _a, existsL1, existsL2;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!this.checkDomain(domain)) {\n              return [2\n              /*return*/\n              , false];\n            }\n\n            tld = domain.split('.').pop();\n\n            if (!tld) {\n              return [2\n              /*return*/\n              , false];\n            }\n\n            return [4\n            /*yield*/\n            , Promise.all([this.unsl1.exists(tld), this.unsl2.exists(tld)])];\n\n          case 1:\n            _a = _b.sent(), existsL1 = _a[0], existsL2 = _a[1];\n            return [2\n            /*return*/\n            , existsL1 || existsL2];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.owner = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenId, data;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            tokenId = this.namehash(domain);\n            return [4\n            /*yield*/\n            , this.get(tokenId, [])];\n\n          case 1:\n            data = _a.sent();\n\n            if (utils_1.isNullAddress(data.owner)) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                domain: domain\n              });\n            }\n\n            return [2\n            /*return*/\n            , data.owner];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.resolver = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getVerifiedData(domain)];\n\n          case 1:\n            return [2\n            /*return*/\n            , _a.sent().resolver];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.record = function (domain, key) {\n    return __awaiter(this, void 0, void 0, function () {\n      var returnee;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.records(domain, [key])];\n\n          case 1:\n            returnee = _a.sent()[key];\n\n            if (!returnee) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.RecordNotFound, {\n                recordName: key,\n                domain: domain\n              });\n            }\n\n            return [2\n            /*return*/\n            , returnee];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.records = function (domain, keys) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getVerifiedData(domain, keys)];\n\n          case 1:\n            return [2\n            /*return*/\n            , _a.sent().records];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.allRecords = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenId, metadata;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            tokenId = this.namehash(domain);\n            return [4\n            /*yield*/\n            , this.getMetadata(tokenId)];\n\n          case 1:\n            metadata = _a.sent();\n            return [2\n            /*return*/\n            , this.records(domain, __spreadArrays(Object.keys(resolver_keys_json_1.default.keys), Object.keys(metadata.properties.records)))];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.twitter = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenId, keys, data, records, location, validationSignature, twitterHandle, owner;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            tokenId = this.namehash(domain);\n            keys = ['validation.social.twitter.username', 'social.twitter.username'];\n            return [4\n            /*yield*/\n            , this.getVerifiedData(domain, keys)];\n\n          case 1:\n            data = _a.sent();\n            records = data.records, location = data.location;\n            validationSignature = records['validation.social.twitter.username'];\n            twitterHandle = records['social.twitter.username'];\n\n            if (utils_1.isNullAddress(validationSignature)) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.RecordNotFound, {\n                domain: domain,\n                location: location,\n                recordName: 'validation.social.twitter.username'\n              });\n            }\n\n            if (!twitterHandle) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.RecordNotFound, {\n                domain: domain,\n                location: location,\n                recordName: 'social.twitter.username'\n              });\n            }\n\n            owner = data.owner;\n\n            if (!TwitterSignatureValidator_1.isValidTwitterSignature({\n              tokenId: tokenId,\n              owner: owner,\n              twitterHandle: twitterHandle,\n              validationSignature: validationSignature\n            })) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.InvalidTwitterVerification, {\n                domain: domain\n              });\n            }\n\n            return [2\n            /*return*/\n            , twitterHandle];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.reverse = function (address, currencyTicker) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnsupportedMethod, {\n          methodName: 'reverse'\n        });\n      });\n    });\n  };\n\n  Uns.prototype.isRegistered = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenId, data;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            tokenId = this.namehash(domain);\n            return [4\n            /*yield*/\n            , this.get(tokenId, [])];\n\n          case 1:\n            data = _a.sent();\n            return [2\n            /*return*/\n            , !utils_1.isNullAddress(data.owner)];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.getTokenUri = function (tokenId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, resultOrErrorL1, resultOrErrorL2;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , Promise.all([this.unsl1.getTokenUri(tokenId).catch(function (err) {\n              return err;\n            }), this.unsl2.getTokenUri(tokenId).catch(function (err) {\n              return err;\n            })])];\n\n          case 1:\n            _a = _b.sent(), resultOrErrorL1 = _a[0], resultOrErrorL2 = _a[1];\n\n            if (resultOrErrorL2 instanceof Error) {\n              if (!resultOrErrorL2.message.includes('ERC721Metadata: URI query for nonexistent token')) {\n                throw resultOrErrorL2;\n              }\n            } else {\n              return [2\n              /*return*/\n              , resultOrErrorL2];\n            }\n\n            if (resultOrErrorL1 instanceof Error) {\n              validResolutionErrorOrThrow(resultOrErrorL1, resolutionError_1.ResolutionErrorCode.ServiceProviderError);\n\n              if (resultOrErrorL1.message === '< execution reverted >') {\n                throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                  domain: \"with tokenId \" + tokenId\n                });\n              }\n            }\n\n            return [2\n            /*return*/\n            , resultOrErrorL1];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.isAvailable = function (domain) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.isRegistered(domain)];\n\n          case 1:\n            return [2\n            /*return*/\n            , !_a.sent()];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.registryAddress = function (domainOrNamehash) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, resultOrErrorL1, resultOrErrorL2;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , Promise.all([this.unsl1.registryAddress(domainOrNamehash).catch(function (err) {\n              return err;\n            }), this.unsl2.registryAddress(domainOrNamehash).catch(function (err) {\n              return err;\n            })])];\n\n          case 1:\n            _a = _b.sent(), resultOrErrorL1 = _a[0], resultOrErrorL2 = _a[1];\n\n            if (resultOrErrorL2 instanceof Error) {\n              validResolutionErrorOrThrow(resultOrErrorL2, resolutionError_1.ResolutionErrorCode.UnregisteredDomain);\n            } else if (!utils_1.isNullAddress(resultOrErrorL2)) {\n              return [2\n              /*return*/\n              , resultOrErrorL2];\n            }\n\n            return [2\n            /*return*/\n            , validResultOrThrow(resultOrErrorL1)];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.locations = function (domains) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, resultL1, resultL2, nonEmptyRecordsFromL2;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , Promise.all([this.unsl1.locations(domains), this.unsl2.locations(domains)])];\n\n          case 1:\n            _a = _b.sent(), resultL1 = _a[0], resultL2 = _a[1];\n            nonEmptyRecordsFromL2 = Object.keys(resultL2).filter(function (k) {\n              return resultL2[k] != null;\n            }).reduce(function (a, k) {\n              var _a;\n\n              return __assign(__assign({}, a), (_a = {}, _a[k] = resultL2[k], _a));\n            }, {});\n            return [2\n            /*return*/\n            , __assign(__assign({}, resultL1), nonEmptyRecordsFromL2)];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.getDomainFromTokenId = function (tokenId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var metadata;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getMetadata(tokenId)];\n\n          case 1:\n            metadata = _a.sent();\n            return [2\n            /*return*/\n            , metadata.name];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.getMetadata = function (tokenId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenUri, resp, metadata;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getTokenUri(tokenId)];\n\n          case 1:\n            tokenUri = _a.sent();\n            return [4\n            /*yield*/\n            , Networking_1.default.fetch(tokenUri, {}).catch(function (err) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.MetadataEndpointError, {\n                tokenUri: tokenUri || 'undefined',\n                errorMessage: err.message\n              });\n            })];\n\n          case 2:\n            resp = _a.sent();\n\n            if (!resp.ok) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.MetadataEndpointError, {\n                tokenUri: tokenUri || 'undefined'\n              });\n            }\n\n            return [4\n            /*yield*/\n            , resp.json()];\n\n          case 3:\n            metadata = _a.sent();\n\n            if (!metadata.name) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                domain: \"with tokenId \" + tokenId\n              });\n            }\n\n            if (this.namehash(metadata.name) !== tokenId) {\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.ServiceProviderError, {\n                methodName: 'unhash',\n                domain: metadata.name,\n                providerMessage: 'Service provider returned an invalid domain name'\n              });\n            }\n\n            return [2\n            /*return*/\n            , metadata];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.getVerifiedData = function (domain, keys) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenId, data;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            tokenId = this.namehash(domain);\n            return [4\n            /*yield*/\n            , this.get(tokenId, keys)];\n\n          case 1:\n            data = _a.sent();\n\n            if (utils_1.isNullAddress(data.resolver)) {\n              if (utils_1.isNullAddress(data.owner)) {\n                throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                  domain: domain\n                });\n              }\n\n              throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnspecifiedResolver, {\n                location: data.location,\n                domain: domain\n              });\n            }\n\n            return [2\n            /*return*/\n            , data];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.get = function (tokenId, keys) {\n    if (keys === void 0) {\n      keys = [];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, resultOrErrorL1, resultOrErrorL2, resolverL2, ownerL2, recordsL2, resolverL1, ownerL1, recordsL1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , Promise.all([this.unsl1.get(tokenId, keys).catch(function (err) {\n              return err;\n            }), this.unsl2.get(tokenId, keys).catch(function (err) {\n              return err;\n            })])];\n\n          case 1:\n            _a = _b.sent(), resultOrErrorL1 = _a[0], resultOrErrorL2 = _a[1];\n            validResultOrThrow(resultOrErrorL2);\n            resolverL2 = resultOrErrorL2.resolver, ownerL2 = resultOrErrorL2.owner, recordsL2 = resultOrErrorL2.records;\n\n            if (!utils_1.isNullAddress(ownerL2)) {\n              return [2\n              /*return*/\n              , {\n                resolver: resolverL2,\n                owner: ownerL2,\n                records: utils_1.constructRecords(keys, recordsL2),\n                location: publicTypes_1.UnsLocation.Layer2\n              }];\n            }\n\n            validResultOrThrow(resultOrErrorL1);\n            resolverL1 = resultOrErrorL1.resolver, ownerL1 = resultOrErrorL1.owner, recordsL1 = resultOrErrorL1.records;\n            return [2\n            /*return*/\n            , {\n              resolver: resolverL1,\n              owner: ownerL1,\n              records: utils_1.constructRecords(keys, recordsL1),\n              location: publicTypes_1.UnsLocation.Layer1\n            }];\n        }\n      });\n    });\n  };\n\n  Uns.prototype.checkDomain = function (domain, passIfTokenID) {\n    if (passIfTokenID === void 0) {\n      passIfTokenID = false;\n    }\n\n    if (passIfTokenID) {\n      return true;\n    }\n\n    var tokens = domain.split('.');\n    return !!tokens.length && tokens[tokens.length - 1] !== 'zil' && !(domain === 'eth' || /^[^-]*[^-]*\\.(eth|luxe|xyz|kred|addr\\.reverse)$/.test(domain)) && tokens.every(function (v) {\n      return !!v.length;\n    });\n  };\n\n  return Uns;\n}(NamingService_1.NamingService);\n\nexports.default = Uns;\n\nfunction validResultOrThrow(resultOrError) {\n  if (resultOrError instanceof Error) {\n    throw resultOrError;\n  }\n\n  return resultOrError;\n}\n\nfunction validResolutionErrorOrThrow(error, validCode) {\n  if (!(error instanceof resolutionError_1.default)) {\n    throw error;\n  }\n\n  if (error.code === validCode) {\n    return true;\n  }\n\n  throw error;\n}","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","__importStar","mod","__esModule","__importDefault","defineProperty","exports","types_1","require","resolutionError_1","utils_1","publicTypes_1","TwitterSignatureValidator_1","FetchProvider_1","namehash_1","NamingService_1","configurationError_1","UnsInternal_1","Networking_1","resolver_keys_json_1","Uns","_super","source","_this","name","NamingServiceName","UNS","locations","Layer1","Layer2","default","ConfigurationErrorCode","NetworkConfigMissing","method","config","url","UrlMap","network","unsl1","UnsLocation","BlockchainType","ETH","unsl2","MATIC","autoNetwork","providerLayer1","providerLayer2","networkIdLayer1","networkIdLayer2","networkNameLayer1","networkNameLayer2","_a","hasProvider","provider","UnspecifiedUrl","factory","request","EthereumNetworksInverted","UnsSupportedNetwork","guard","UnsupportedNetwork","namehash","domain","checkDomain","ResolutionErrorCode","UnsupportedDomain","eip137Namehash","childhash","parentHash","eip137Childhash","serviceName","isSupportedDomain","tld","existsL1","existsL2","_b","split","all","exists","owner","tokenId","data","get","isNullAddress","UnregisteredDomain","resolver","getVerifiedData","record","key","returnee","records","RecordNotFound","recordName","keys","allRecords","metadata","getMetadata","properties","twitter","location","validationSignature","twitterHandle","isValidTwitterSignature","InvalidTwitterVerification","reverse","address","currencyTicker","UnsupportedMethod","methodName","isRegistered","getTokenUri","resultOrErrorL1","resultOrErrorL2","catch","err","Error","message","includes","validResolutionErrorOrThrow","ServiceProviderError","isAvailable","registryAddress","domainOrNamehash","validResultOrThrow","domains","resultL1","resultL2","nonEmptyRecordsFromL2","filter","reduce","getDomainFromTokenId","tokenUri","resp","fetch","MetadataEndpointError","errorMessage","ok","json","providerMessage","UnspecifiedResolver","resolverL2","ownerL2","recordsL2","resolverL1","ownerL1","recordsL1","constructRecords","passIfTokenID","tokens","test","every","NamingService","resultOrError","error","validCode","code"],"sources":["/Users/mac/Desktop/work/wave-frontend/node_modules/@unstoppabledomains/resolution/build/Uns.js"],"sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar types_1 = require(\"./types\");\nvar resolutionError_1 = __importStar(require(\"./errors/resolutionError\"));\nvar utils_1 = require(\"./utils\");\nvar publicTypes_1 = require(\"./types/publicTypes\");\nvar TwitterSignatureValidator_1 = require(\"./utils/TwitterSignatureValidator\");\nvar FetchProvider_1 = __importDefault(require(\"./FetchProvider\"));\nvar namehash_1 = require(\"./utils/namehash\");\nvar NamingService_1 = require(\"./NamingService\");\nvar configurationError_1 = __importStar(require(\"./errors/configurationError\"));\nvar UnsInternal_1 = __importDefault(require(\"./UnsInternal\"));\nvar Networking_1 = __importDefault(require(\"./utils/Networking\"));\nvar resolver_keys_json_1 = __importDefault(require(\"./config/resolver-keys.json\"));\n/**\n * @internal\n */\nvar Uns = /** @class */ (function (_super) {\n    __extends(Uns, _super);\n    function Uns(source) {\n        var _this = _super.call(this) || this;\n        _this.name = publicTypes_1.NamingServiceName.UNS;\n        if (source &&\n            source.locations &&\n            (!source.locations.Layer1 || !source.locations.Layer2)) {\n            throw new configurationError_1.default(configurationError_1.ConfigurationErrorCode.NetworkConfigMissing, {\n                method: publicTypes_1.NamingServiceName.UNS,\n                config: !source.locations.Layer1 ? 'Layer1' : 'Layer2',\n            });\n        }\n        if (!source) {\n            source = {\n                locations: {\n                    Layer1: {\n                        url: UnsInternal_1.default.UrlMap['mainnet'],\n                        network: 'mainnet',\n                    },\n                    Layer2: {\n                        url: UnsInternal_1.default.UrlMap['polygon-mainnet'],\n                        network: 'polygon-mainnet',\n                    },\n                },\n            };\n        }\n        _this.unsl1 = new UnsInternal_1.default(publicTypes_1.UnsLocation.Layer1, source.locations.Layer1, publicTypes_1.BlockchainType.ETH);\n        _this.unsl2 = new UnsInternal_1.default(publicTypes_1.UnsLocation.Layer2, source.locations.Layer2, publicTypes_1.BlockchainType.MATIC);\n        return _this;\n    }\n    Uns.autoNetwork = function (config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var providerLayer1, providerLayer2, networkIdLayer1, networkIdLayer2, networkNameLayer1, networkNameLayer2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (types_1.hasProvider(config.locations.Layer1) &&\n                            types_1.hasProvider(config.locations.Layer2)) {\n                            providerLayer1 = config.locations.Layer1.provider;\n                            providerLayer2 = config.locations.Layer2.provider;\n                        }\n                        else {\n                            if (!config.locations.Layer1['url'] || !config.locations.Layer2['url']) {\n                                throw new configurationError_1.default(configurationError_1.ConfigurationErrorCode.UnspecifiedUrl, {\n                                    method: publicTypes_1.NamingServiceName.UNS,\n                                });\n                            }\n                            providerLayer1 = FetchProvider_1.default.factory(publicTypes_1.NamingServiceName.UNS, config.locations.Layer1['url']);\n                            providerLayer2 = FetchProvider_1.default.factory(publicTypes_1.NamingServiceName.UNS, config.locations.Layer2['url']);\n                        }\n                        return [4 /*yield*/, providerLayer1.request({\n                                method: 'net_version',\n                            })];\n                    case 1:\n                        networkIdLayer1 = (_a.sent());\n                        return [4 /*yield*/, providerLayer2.request({\n                                method: 'net_version',\n                            })];\n                    case 2:\n                        networkIdLayer2 = (_a.sent());\n                        networkNameLayer1 = utils_1.EthereumNetworksInverted[networkIdLayer1];\n                        networkNameLayer2 = utils_1.EthereumNetworksInverted[networkIdLayer2];\n                        if (!networkNameLayer1 ||\n                            !types_1.UnsSupportedNetwork.guard(networkNameLayer1) ||\n                            !networkNameLayer2 ||\n                            !types_1.UnsSupportedNetwork.guard(networkNameLayer2)) {\n                            throw new configurationError_1.default(configurationError_1.ConfigurationErrorCode.UnsupportedNetwork, {\n                                method: publicTypes_1.NamingServiceName.UNS,\n                            });\n                        }\n                        return [2 /*return*/, new this({\n                                locations: {\n                                    Layer1: { network: networkNameLayer1, provider: providerLayer1 },\n                                    Layer2: { network: networkNameLayer2, provider: providerLayer2 },\n                                },\n                            })];\n                }\n            });\n        });\n    };\n    Uns.prototype.namehash = function (domain) {\n        if (!this.checkDomain(domain)) {\n            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnsupportedDomain, {\n                domain: domain,\n            });\n        }\n        return namehash_1.eip137Namehash(domain);\n    };\n    Uns.prototype.childhash = function (parentHash, label) {\n        return namehash_1.eip137Childhash(parentHash, label);\n    };\n    Uns.prototype.serviceName = function () {\n        return this.name;\n    };\n    Uns.prototype.isSupportedDomain = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tld, _a, existsL1, existsL2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.checkDomain(domain)) {\n                            return [2 /*return*/, false];\n                        }\n                        tld = domain.split('.').pop();\n                        if (!tld) {\n                            return [2 /*return*/, false];\n                        }\n                        return [4 /*yield*/, Promise.all([\n                                this.unsl1.exists(tld),\n                                this.unsl2.exists(tld),\n                            ])];\n                    case 1:\n                        _a = _b.sent(), existsL1 = _a[0], existsL2 = _a[1];\n                        return [2 /*return*/, existsL1 || existsL2];\n                }\n            });\n        });\n    };\n    Uns.prototype.owner = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenId, data;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        tokenId = this.namehash(domain);\n                        return [4 /*yield*/, this.get(tokenId, [])];\n                    case 1:\n                        data = _a.sent();\n                        if (utils_1.isNullAddress(data.owner)) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                                domain: domain,\n                            });\n                        }\n                        return [2 /*return*/, data.owner];\n                }\n            });\n        });\n    };\n    Uns.prototype.resolver = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getVerifiedData(domain)];\n                    case 1: return [2 /*return*/, (_a.sent()).resolver];\n                }\n            });\n        });\n    };\n    Uns.prototype.record = function (domain, key) {\n        return __awaiter(this, void 0, void 0, function () {\n            var returnee;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.records(domain, [key])];\n                    case 1:\n                        returnee = (_a.sent())[key];\n                        if (!returnee) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.RecordNotFound, {\n                                recordName: key,\n                                domain: domain,\n                            });\n                        }\n                        return [2 /*return*/, returnee];\n                }\n            });\n        });\n    };\n    Uns.prototype.records = function (domain, keys) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getVerifiedData(domain, keys)];\n                    case 1: return [2 /*return*/, (_a.sent()).records];\n                }\n            });\n        });\n    };\n    Uns.prototype.allRecords = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenId, metadata;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        tokenId = this.namehash(domain);\n                        return [4 /*yield*/, this.getMetadata(tokenId)];\n                    case 1:\n                        metadata = _a.sent();\n                        return [2 /*return*/, this.records(domain, __spreadArrays(Object.keys(resolver_keys_json_1.default.keys), Object.keys(metadata.properties.records)))];\n                }\n            });\n        });\n    };\n    Uns.prototype.twitter = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenId, keys, data, records, location, validationSignature, twitterHandle, owner;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        tokenId = this.namehash(domain);\n                        keys = [\n                            'validation.social.twitter.username',\n                            'social.twitter.username',\n                        ];\n                        return [4 /*yield*/, this.getVerifiedData(domain, keys)];\n                    case 1:\n                        data = _a.sent();\n                        records = data.records, location = data.location;\n                        validationSignature = records['validation.social.twitter.username'];\n                        twitterHandle = records['social.twitter.username'];\n                        if (utils_1.isNullAddress(validationSignature)) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.RecordNotFound, {\n                                domain: domain,\n                                location: location,\n                                recordName: 'validation.social.twitter.username',\n                            });\n                        }\n                        if (!twitterHandle) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.RecordNotFound, {\n                                domain: domain,\n                                location: location,\n                                recordName: 'social.twitter.username',\n                            });\n                        }\n                        owner = data.owner;\n                        if (!TwitterSignatureValidator_1.isValidTwitterSignature({\n                            tokenId: tokenId,\n                            owner: owner,\n                            twitterHandle: twitterHandle,\n                            validationSignature: validationSignature,\n                        })) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.InvalidTwitterVerification, {\n                                domain: domain,\n                            });\n                        }\n                        return [2 /*return*/, twitterHandle];\n                }\n            });\n        });\n    };\n    Uns.prototype.reverse = function (address, currencyTicker) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnsupportedMethod, {\n                    methodName: 'reverse',\n                });\n            });\n        });\n    };\n    Uns.prototype.isRegistered = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenId, data;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        tokenId = this.namehash(domain);\n                        return [4 /*yield*/, this.get(tokenId, [])];\n                    case 1:\n                        data = _a.sent();\n                        return [2 /*return*/, !utils_1.isNullAddress(data.owner)];\n                }\n            });\n        });\n    };\n    Uns.prototype.getTokenUri = function (tokenId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, resultOrErrorL1, resultOrErrorL2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, Promise.all([\n                            this.unsl1.getTokenUri(tokenId).catch(function (err) { return err; }),\n                            this.unsl2.getTokenUri(tokenId).catch(function (err) { return err; }),\n                        ])];\n                    case 1:\n                        _a = _b.sent(), resultOrErrorL1 = _a[0], resultOrErrorL2 = _a[1];\n                        if (resultOrErrorL2 instanceof Error) {\n                            if (!resultOrErrorL2.message.includes('ERC721Metadata: URI query for nonexistent token')) {\n                                throw resultOrErrorL2;\n                            }\n                        }\n                        else {\n                            return [2 /*return*/, resultOrErrorL2];\n                        }\n                        if (resultOrErrorL1 instanceof Error) {\n                            validResolutionErrorOrThrow(resultOrErrorL1, resolutionError_1.ResolutionErrorCode.ServiceProviderError);\n                            if (resultOrErrorL1.message === '< execution reverted >') {\n                                throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                                    domain: \"with tokenId \" + tokenId,\n                                });\n                            }\n                        }\n                        return [2 /*return*/, resultOrErrorL1];\n                }\n            });\n        });\n    };\n    Uns.prototype.isAvailable = function (domain) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.isRegistered(domain)];\n                    case 1: return [2 /*return*/, !(_a.sent())];\n                }\n            });\n        });\n    };\n    Uns.prototype.registryAddress = function (domainOrNamehash) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, resultOrErrorL1, resultOrErrorL2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, Promise.all([\n                            this.unsl1.registryAddress(domainOrNamehash).catch(function (err) { return err; }),\n                            this.unsl2.registryAddress(domainOrNamehash).catch(function (err) { return err; }),\n                        ])];\n                    case 1:\n                        _a = _b.sent(), resultOrErrorL1 = _a[0], resultOrErrorL2 = _a[1];\n                        if (resultOrErrorL2 instanceof Error) {\n                            validResolutionErrorOrThrow(resultOrErrorL2, resolutionError_1.ResolutionErrorCode.UnregisteredDomain);\n                        }\n                        else if (!utils_1.isNullAddress(resultOrErrorL2)) {\n                            return [2 /*return*/, resultOrErrorL2];\n                        }\n                        return [2 /*return*/, validResultOrThrow(resultOrErrorL1)];\n                }\n            });\n        });\n    };\n    Uns.prototype.locations = function (domains) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, resultL1, resultL2, nonEmptyRecordsFromL2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, Promise.all([\n                            this.unsl1.locations(domains),\n                            this.unsl2.locations(domains),\n                        ])];\n                    case 1:\n                        _a = _b.sent(), resultL1 = _a[0], resultL2 = _a[1];\n                        nonEmptyRecordsFromL2 = Object.keys(resultL2)\n                            .filter(function (k) { return resultL2[k] != null; })\n                            .reduce(function (a, k) {\n                            var _a;\n                            return (__assign(__assign({}, a), (_a = {}, _a[k] = resultL2[k], _a)));\n                        }, {});\n                        return [2 /*return*/, __assign(__assign({}, resultL1), nonEmptyRecordsFromL2)];\n                }\n            });\n        });\n    };\n    Uns.prototype.getDomainFromTokenId = function (tokenId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var metadata;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getMetadata(tokenId)];\n                    case 1:\n                        metadata = _a.sent();\n                        return [2 /*return*/, metadata.name];\n                }\n            });\n        });\n    };\n    Uns.prototype.getMetadata = function (tokenId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenUri, resp, metadata;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getTokenUri(tokenId)];\n                    case 1:\n                        tokenUri = _a.sent();\n                        return [4 /*yield*/, Networking_1.default.fetch(tokenUri, {}).catch(function (err) {\n                                throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.MetadataEndpointError, {\n                                    tokenUri: tokenUri || 'undefined',\n                                    errorMessage: err.message,\n                                });\n                            })];\n                    case 2:\n                        resp = _a.sent();\n                        if (!resp.ok) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.MetadataEndpointError, {\n                                tokenUri: tokenUri || 'undefined',\n                            });\n                        }\n                        return [4 /*yield*/, resp.json()];\n                    case 3:\n                        metadata = _a.sent();\n                        if (!metadata.name) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                                domain: \"with tokenId \" + tokenId,\n                            });\n                        }\n                        if (this.namehash(metadata.name) !== tokenId) {\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.ServiceProviderError, {\n                                methodName: 'unhash',\n                                domain: metadata.name,\n                                providerMessage: 'Service provider returned an invalid domain name',\n                            });\n                        }\n                        return [2 /*return*/, metadata];\n                }\n            });\n        });\n    };\n    Uns.prototype.getVerifiedData = function (domain, keys) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenId, data;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        tokenId = this.namehash(domain);\n                        return [4 /*yield*/, this.get(tokenId, keys)];\n                    case 1:\n                        data = _a.sent();\n                        if (utils_1.isNullAddress(data.resolver)) {\n                            if (utils_1.isNullAddress(data.owner)) {\n                                throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnregisteredDomain, {\n                                    domain: domain,\n                                });\n                            }\n                            throw new resolutionError_1.default(resolutionError_1.ResolutionErrorCode.UnspecifiedResolver, {\n                                location: data.location,\n                                domain: domain,\n                            });\n                        }\n                        return [2 /*return*/, data];\n                }\n            });\n        });\n    };\n    Uns.prototype.get = function (tokenId, keys) {\n        if (keys === void 0) { keys = []; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, resultOrErrorL1, resultOrErrorL2, resolverL2, ownerL2, recordsL2, resolverL1, ownerL1, recordsL1;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, Promise.all([\n                            this.unsl1.get(tokenId, keys).catch(function (err) { return err; }),\n                            this.unsl2.get(tokenId, keys).catch(function (err) { return err; }),\n                        ])];\n                    case 1:\n                        _a = _b.sent(), resultOrErrorL1 = _a[0], resultOrErrorL2 = _a[1];\n                        validResultOrThrow(resultOrErrorL2);\n                        resolverL2 = resultOrErrorL2.resolver, ownerL2 = resultOrErrorL2.owner, recordsL2 = resultOrErrorL2.records;\n                        if (!utils_1.isNullAddress(ownerL2)) {\n                            return [2 /*return*/, {\n                                    resolver: resolverL2,\n                                    owner: ownerL2,\n                                    records: utils_1.constructRecords(keys, recordsL2),\n                                    location: publicTypes_1.UnsLocation.Layer2,\n                                }];\n                        }\n                        validResultOrThrow(resultOrErrorL1);\n                        resolverL1 = resultOrErrorL1.resolver, ownerL1 = resultOrErrorL1.owner, recordsL1 = resultOrErrorL1.records;\n                        return [2 /*return*/, {\n                                resolver: resolverL1,\n                                owner: ownerL1,\n                                records: utils_1.constructRecords(keys, recordsL1),\n                                location: publicTypes_1.UnsLocation.Layer1,\n                            }];\n                }\n            });\n        });\n    };\n    Uns.prototype.checkDomain = function (domain, passIfTokenID) {\n        if (passIfTokenID === void 0) { passIfTokenID = false; }\n        if (passIfTokenID) {\n            return true;\n        }\n        var tokens = domain.split('.');\n        return (!!tokens.length &&\n            tokens[tokens.length - 1] !== 'zil' &&\n            !(domain === 'eth' ||\n                /^[^-]*[^-]*\\.(eth|luxe|xyz|kred|addr\\.reverse)$/.test(domain)) &&\n            tokens.every(function (v) { return !!v.length; }));\n    };\n    return Uns;\n}(NamingService_1.NamingService));\nexports.default = Uns;\nfunction validResultOrThrow(resultOrError) {\n    if (resultOrError instanceof Error) {\n        throw resultOrError;\n    }\n    return resultOrError;\n}\nfunction validResolutionErrorOrThrow(error, validCode) {\n    if (!(error instanceof resolutionError_1.default)) {\n        throw error;\n    }\n    if (error.code === validCode) {\n        return true;\n    }\n    throw error;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}